#!/bin/sh

. daemonize

usage() {
    echo "Usage: $(basename $0) [OPTIONS] <LOCATION> <HOST> <PORT> <COMMAND>"
    echo ""
    exit 0
}

[ $# -ne 4 ] && usage

location=$1
host=$2
port=$3
cmd=$4

stream_root=$(make_hash $location $host $port)
stream_leaf=$stream_root

case $cmd in
    start)
        daemon_start $stream_root $stream_leaf "rtmp2rtsp $location $host $port"
        ;;
    stop)
        daemon_stop $stream_root $stream_leaf
        ;;
    status)
        status $stream_root $stream_leaf
        ;;
    info)
        echo "$(path_to_stream $stream_root)"
        ;;
    *)  usage
        ;;
esac
